/*! matreshka v0.0.4 (08.01.2014)
Author: Andrey Gubanov <a@odessite.com.ua>
License: MIT 
*/
"use strict";!function(a,b,c,d,e,f,g){var h,i,j,k=/\.(.+)/,l="$b",m=0,n={},o=a.$=a[l]=function(a,b){return new o.i(a,b)};o.i=function(d,e){c.push.apply(this,d?d&&d.nodeType?[d]:""+d===d?(e&&!e.nodeType&&e[0]||e||b).querySelectorAll(d):/f/.test(typeof d)?/c/.test(b.readyState)?d():o(b).on("DOMContentLoaded",d):d===a?[d]:d:c)},o.i[f]=(o.extend=function(a){var b,c=arguments;for(h=1;h<c.length;h++)if(b=c[h])for(i in b)a[i]=b[i];return a})(o.fn=o[f]=c,{on:function(a,b){return a=a.split(k),j=a[0],this[g](function(c){h=j+(c[l]=c[l]||++m),(n[h]=n[h]||[]).push({handler:b,namespace:a[1],type:j}),c["add"+d](j,b)}),this},off:function(a,b){a=a.split(k),j=a[0];var e=a[1];return this[g](function(a){var f,i,k=a[l];e||!b?(n[j+k]||c)[g](function(c){i=c.handler,b&&b!==i||e&&e!==c.namespace||(a["remove"+d](j,i),f.splice(h--,1))}):a["remove"+d](j,b)}),this},is:function(a){return h=this[0],i=h&&(h.matches||h["webkit"+e]||h["moz"+e]||h["ms"+e]),!!i&&i.call(h,a)}})}(this,document,[],"EventListener","MatchesSelector","prototype","forEach"),!function(a,b,c){if(a.documentMode<=8){var d,e,f=function(a){for(e=[],d=a.length;d--;e[d]=a[d]);return e},g=$b.i[c];$b.i=function(c,d){c&&c.constructor===Array&&(c=f(c)),b.push.apply(this,c?c&&c.nodeType?[c]:""+c===c?f((d&&!d.nodeType&&d[0]||d||a).querySelectorAll(c)):/f/.test(typeof c)?/c/.test(a.readyState)?c()||b:!function e(b){/in/(a.readyState)?setTimeout(e,9,b):b()}(c)||b:c===window?[c]:c:b)},$b.i[c]=g,$b("html").is("html")||($b.fn.is=function(b){var c,d,e=this[0],f="b_b";return e&&b&&e.setAttribute?(e.setAttribute(f,f),d=a.querySelector(b+'[b_b="b_b"]'),c=d===e,e.removeAttribute(f,f),c):!1})}}(document,[],"prototype"),function(a){var b=function(a){return!!a&&("[object Arguments]"===a.toString()||"object"==typeof a&&null!==a&&"length"in a&&"callee"in a)},c=function(){var a=-1;if("Microsoft Internet Explorer"==navigator.appName){var b=navigator.userAgent,c=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!=c.exec(b)&&(a=parseFloat(RegExp.$1))}return a}(),d=document.documentMode,e=8===d,f="Internet Explorer "+c+" doesn't support Class function";if(~c&&8>c)throw Error(f);if(8>d)throw Error(f+'. Switch your "Document Mode" to "Standards"');a.Class=function(a){var c=h=a.constructor!==Object?a.constructor:function(){},d=a["extends"]=a["extends"]||a.extend,f=d&&d.prototype,g=a["implements"]=a["implements"]||a.implement,h=c,i={};if(delete a.extend,delete a.implement,f){for(var j in f)i[j]="function"==typeof f[j]?function(a){return function(c,d){return d=b(d)?d:Array.prototype.splice.call(arguments,1),a.apply(c,d)}}(f[j]):f[j];i.constructor=function(a){return function(c,d){return d=b(d)?d:Array.prototype.splice.call(arguments,1),a.apply(c,d)}}(f.constructor)}return e?(a.prototype=null,a.constructor=null,c=function(){if(this instanceof c){var a=new XDomainRequest;for(var b in c.prototype)"constructor"!==b&&(a[b]=c.prototype[b]);return a.hasOwnProperty=c.prototype.hasOwnProperty,h.apply(a,arguments),a}h.apply(this,arguments)},a.constructor=c,c.prototype=a,c.parent=i,d&&Class.IEInherits(c,d)):(a.constructor=c,c.prototype=a,c.parent=i,d&&Class.inherits(c,d)),g&&g.validate(c.prototype),this instanceof Class?new c:c},Class.inherits=function(a,b){var c=a.prototype,d=function(){};d.prototype=b.prototype,a.prototype=new d,a.prototype.constructor=a;for(var e in c)a.prototype[e]=c[e];a.prototype.instanceOf=function(a){return this instanceof a}},Class.IEInherits=function(a,b){for(var c,d=a.prototype.hasOwnProperty,e=a.prototype.constructor,f=Object.prototype.hasOwnProperty;b;)c=c||b.prototype.hasOwnProperty,a.prototype=function(a,b){var c,d={};for(c in a)d[c]=a[c];for(c in b)d[c]=b[c];return d}(b.prototype,a.prototype),b=b.prototype&&b.prototype["extends"]&&b.prototype["extends"].prototype;d!==f?a.prototype.hasOwnProperty=d:c!==f&&(a.prototype.hasOwnProperty=c),a.prototype.constructor=e,a.prototype.instanceOf=function(b){for(var c=a;c;){if(c===b)return!0;c=c.prototype["extends"]}return!1}},a.Class.isXDR=e}(this),function(a,b){if(!b)throw Error("Class function is not defined");var c,d={list:{},add:function(a){c(a.el).on(a.on.split(/\s/).join(".mk ")+".mk",a.handler);var b=this.list[a.instance.__id]=this.list[a.instance.__id]||[];b.push(a)},rem:function(a){var b,d=this.list[a.instance.__id];if(d)for(var e=0;e<d.length;e++)b=d[e],b.el===a.el&&(a.instance.off("_change:"+a.key,b.mkHandler),c(a.el).off(b.on+".mk",b.handler),this.list[a.instance.__id].splice(e--,1))}},e=function(){var a=window.$b;return a._extendedByMK?a:(a._extendedByMK=!0,f.extend(a.fn,{hasClass:function(a){return!!this[0]&&this[0].classList.contains(a)},addClass:function(a){return this.forEach(function(b){var c=b.classList;c.add.apply(c,a.split(/\s/))}),this},removeClass:function(a){return this.forEach(function(b){var c=b.classList;c.remove.apply(c,a.split(/\s/))}),this},toggleClass:function(a,b){return this.forEach(function(c){var d=c.classList;d[b?"add":"remove"].apply(d,a.split(/\s/))}),this},add:function(b){var c=a(this);b=a(b).slice(),[].push.apply(c,b);for(var d=c.length-b.length;d<c.length;d++)c.indexOf(c[d])!==d&&c.splice(d--,1);return c},find:function(b){var c=a();return this.forEach(function(d){c=c.add(a(b,d))}),c},filter:function(){return c([].filter.apply(this,arguments))}}),a)},f=a.MK=a.Matreshka=b({isMK:!0,on:function(a,b,c,d){if(!b)throw Error('callback is not function for event "'+a+'"');var e,f,g,a=a.split(/\s/);"boolean"!=typeof c&&(g=d,d=c,c=g);for(var h=0;h<a.length;h++)e=this.__events[a[h]]||(this.__events[a[h]]=[]),f={callback:b,context:d,ctx:d||this},e.push(f),a[h].indexOf("change:")||this.makeSpecial(a[h].replace("change:",""));return c===!0&&f.callback.call(f.ctx,{triggeredOnInit:!0}),this},once:function(a,b,c){if(!b)throw Error('callback is not function for event "'+a+'"');var d=this,e=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}};a=a.split(/\s/);for(var f=0;f<a.length;f++)(function(a){var f=e(function(){d.off(a,f),b.apply(this,arguments)});f._callback=b,this.on(a,f,c)}).call(this,name),a[f].indexOf("change:")||this.makeSpecial(a[f].replace("change:",""));return this},off:function(a,b,c){var d,e,f,a,g,h,i,j;if(!a&&!b&&!c)return this.events={},this;for(a=a.split(/\s/),g=0,h=a.length;h>g;g++)if(name=a[g],f=this.__events[name]){if(this.__events[name]=d=[],b||c)for(i=0,j=f.length;j>i;i++)e=f[i],(b&&b!==e.callback&&b!==e.callback._callback||c&&c!==e.context)&&d.push(e);d.length||delete this.__events[name]}return this},trigger:function(a){var b,c=Array.prototype.slice.call(arguments,1),d=c[0]&&c[0].silentAllEvent,e=this.__events.all,f=function(a,b){for(var c,d=-1,e=a.length;++d<e;)(c=a[d]).callback.apply(c.ctx,b||[])};if(a){a=a.split(/\s/);for(var g=0;g<a.length;g++)b=this.__events[a[g]],b&&f(b,c)}return e&&!d&&f(e,arguments),this},elementProcessor:function(a){for(var b,c=f.elementProcessors,d=0;d<c.length;d++)if(b=c[d](a))return b;return{}},bindElement:function(a,b,e,g){var h,i,j,k=this,l=a in this;if(this.eq(a)&&(a="__this__"),a instanceof Array){for(j=0;j<a.length;j++)this.bindElement(a[j][0],a[j][1],a[j][2]||g,b);return this}if("string"==typeof a&&(i=a.split(/\s/),i.length>1)){for(j=0;j<i.length;j++)this.bindElement(i[j],b,e,g);return this}if("object"==typeof a){for(j in a)a.hasOwnProperty(j)&&this.bindElement(j,a[j],b,e);return this}if(this.makeSpecial(a),h=c(b),!h.length){try{console.warn('Bound Element is missing for key "'+a+'"')}catch(m){}return this}return this.__special[a].elements=this.__special[a].elements.add(h),f.each(h,function(b){var c,g=null!==e?f.extend("__this__"===a?{}:k.elementProcessor(b),e):{};g.setValue&&(c=function(){g.setValue.call(b,k[a],k,a)},k.on("_change:"+a,c),!l&&g.getValue?k.__special[a].value=g.getValue.call(b,k,a,null):l&&c()),g.getValue&&g.on&&d.add({el:b,on:g.on,instance:k,key:a,mkHandler:c,handler:function(c){var d=g.getValue.call(b,k,a,c);d!==k[a]&&k.set(a,d,{fromElement:!0})}})}),g&&g.silent||this.trigger("bind:"+a,f.extend({key:a,$el:h,el:h[0]||null},g)),this},unbindElement:function(a,b,e){var g,h,i=d[this.__id];if(!i)return this;if(this.eq(a)&&(a="__this__"),a instanceof Array){for(var j=0;j<a.length;j++)e=b,this.unbindElement(a[j][0],a[j][1]||e,e);return this}if("string"==typeof a&&(h=a.split(/\s/),h.length>1)){for(j=0;j<h.length;j++)this.unbindElement(h[j],b,e);return this}if("object"==typeof a&&null!==a){for(var j in a)a.hasOwnProperty(j)&&this.unbindElement(j,a[j],b);return this}if(null===a){for(a in this.__special)this.__special.hasOwnProperty(a)&&this.unbindElement(a,b,e);return this}return b?(g=c(b),f.each(g,function(a){d.rem({el:a,instance:this})},this),e&&e.silent||this.trigger("unbind:"+a,f.extend({key:a,$el:g,el:g[0]||null},e)),this):this.__special[a]&&this.__special[a].elements?this.unbindElement(a,this.__special[a].elements,e):this},$el:function(a){a=a!==this&&a?a:"__this__";var b,d=a.split(/\s/);if(d.length<=1)return a in this.__special?this.__special[a].elements:c();b=c();for(var e=0;e<d.length;e++)b=b.add(this.__special[d[e]].elements);return b},el:function(a){return this.$el(a)[0]||null},$:function(a){return this.$el().find(a)},makeSpecial:function(a){var b=this.__special[a];return b||(b=this.__special[a]={elements:c(),value:this[a],getter:function(){return b.value}},Object.defineProperty(this,a,{configurable:!0,get:function(){return b.getter()},set:function(b){this.set(a,b,{fromSetter:!0})}})),b},eq:function(a){return"object"==typeof a&&null!==a&&this.__id===a.__id},defineGetter:function(a,b){if("object"==typeof a){for(var c in a)a.hasOwnProperty(c)&&this.defineGetter(c,a[c]);return this}return this.makeSpecial(a).getter=b.bind(this),this},addDependence:function(a,b,c,d){var e,f,b="string"==typeof b?b.split(/\s/):b;d!==!1&&this.set(a,c.call(this));for(var g=0;g<b.length;g++)"object"==typeof b[g]&&b[g][0].isMK?(e=b[g][0],f=b[g][1]):(e=this,f=b[g]),e.makeSpecial(f),e.on("_change:"+f,function(d){for(var g=[],h=0;h<b.length;h++)"object"==typeof b[h]&&b[h][0].isMK?(e=b[h][0],f=b[h][1]):(e=this,f=b[h]),g.push(e[f]);this.set(a,c.apply(this,g),{silent:d.silentChangeEvent})},this);return this},get:function(a){return this[a]},set:function(a,b,c){if("undefined"==typeof a)return this;if("object"==typeof a&&a!==this){for(var d in a)a.hasOwnProperty(d)&&this.set(d,a[d],b);return this}if(!this.__special||!this.__special[a])return this[a]=b,this;var e,g=this.__special[a].value;return this.__special[a].value=b,c=c||{},(b!==g||c.force||c.forceHTML)&&this.trigger("_change:"+a,{silentAllEvent:!0,silentChangeEvent:c.silent||b===g}),b===g&&!c.force||c.silent||(e=f.extend({value:b,previousValue:g,key:a,el:this.__special[a].elements[0]||null,$el:this.__special[a].elements,self:this},c),this.trigger("change:"+a,e).trigger("change",e)),this},remove:function(a,b){var c,d=a.split(/\s/);b=f.extend({keys:d},b);for(var e=0;e<d.length;e++)c=d[e]in this,c&&(b.key=d[e],b.value=this[d[e]],this.unbindElement(d[e]).off("change:"+d[e]),delete this.__special[d[e]],delete this[d[e]],b&&b.silent||this.trigger("remove",b).trigger("remove:"+d[e],b));return this},define:function(a,b){if("object"==typeof a){for(var c in a)this.define(c,a[c]);return this}return Object.defineProperty(this,a,b),this},defineNotEnum:function(a,b){if("object"==typeof a){for(var c in a)this.defineNotEnum(c,a[c]);return this}return f.isXDR?Object.defineProperty(this,a,{get:function(){return b},set:function(a){b=a},configurable:!0}):Object.defineProperty(this,a,{value:b,enumerable:!1,writable:!0,configurable:!0}),this},initMK:function(){return this.defineNotEnum({__id:this.__id||"mk"+(new Date).getTime()+Math.random(),__events:this.__events||{},__special:this.__special||{}})},toString:function(){return"[object Matreshka]"},constructor:function(){this.initMK()}});f.extend=function(a,b){for(var c=1;c<arguments.length;c++){b=arguments[c];for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d])}return a},f.extend(f,{useBalalaika:function(){c=e()},isXDR:b.isXDR,elementProcessors:[],htmlp:{setValue:function(a){this.innerHTML=null===a?"":a}},classp:function(a){var b=!a.indexOf("!");return b&&(a=a.replace("!","")),{setValue:function(d){c(this).toggleClass(a,b?!d:!!d)}}},noop:function(){},each:function(a,b,c){if(a){if("length"in a)[].forEach.call(a,b,c);else for(var d in a)a.hasOwnProperty(d)&&b.call(c,a[d],d,a);return a}}}),f.elementProcessors.push(function(a){return"INPUT"===a.tagName&&"checkbox"===a.type?{on:"click",getValue:function(){return this.checked},setValue:function(a){this.checked=a}}:"INPUT"===a.tagName&&"radio"===a.type?{on:"click",getValue:function(){return this.value},setValue:function(a){this.checked=this.value==a}}:"INPUT"===a.tagName||"TEXTAREA"===a.tagName?{on:"keyup",getValue:function(){return this.value},setValue:function(a){this.value=a}}:"SELECT"===a.tagName?{on:"change",getValue:function(){return this.value},setValue:function(a){if(this.value=a,!a)for(var b=this.options.length-1;b>=0;b--)this.options[b].value===a&&(this.options[b].selected=!0)}}:void 0}),c=window.jQuery||e()}(this,this.Class),function(a){if(!a)throw Error("Matreshka is not defined");a.Object=Class({"extends":a,constructor:function(a){this.initMK(),a&&this.jset(a)},keys:function(){var a=[];for(var b in this._keys)this._keys.hasOwnProperty(b)&&a.push(b);return a},initMK:function(){return a.Object.parent.initMK(this,arguments),this.defineNotEnum("_keys",{}).on("remove",function(a){a&&a.silent||this.trigger("modify",a)}).on("change",function(a){a&&a.key in this._keys&&!a.silent&&this.trigger("modify",a)})},hasOwnProperty:function(a){return this._keys.hasOwnProperty(a)},toObject:function(){var a={},b=this._keys;for(var c in b)b.hasOwnProperty(c)&&(a[c]=this[c]);return a},toNative:function(){return this.toObject()},toJSON:function(){var a={},b=this._keys;for(var c in b)b.hasOwnProperty(c)&&(a[c]=this[c]&&this[c].toJSON?this[c].toJSON():this[c]);return a},keyOf:function(a){var b=this._keys;for(var c in b)if(b.hasOwnProperty(c)&&a===b[c])return c;return null},jset:function(a,b,c){if("undefined"==typeof a)return this;if("object"==typeof a){for(var d in a)this.jset(d,a[d],b);return this}return this._keys[a]=1,this.makeSpecial(a),this.set(a,b,c)},remove:function(b,c){return this.removeJSONKeys(b),a.Object.parent.remove(this,b,c)},addJSONKeys:function(a){a=arguments.length>1?arguments:a instanceof Array?a:a.split(/\s/);for(var b=0;b<a.length;b++)this._keys[a[b]]=1,this.makeSpecial(a[b]);return this},removeJSONKeys:function(a){a=arguments.length>1?arguments:a instanceof Array?a:a.split(/\s/);for(var b=0;b<a.length;b++)delete this._keys[a[b]];return this},each:function(a,b){for(var c in this._keys)this._keys.hasOwnProperty(c)&&a.call(b,this[c],c,this);return this}})}(window.Matreshka),function(a,b){if(!a)throw Error("Matreshka is not defined");var c=1,d=2,e=3,f=4,g=5,h=function(h,i,j){if(!b[i])throw Error("There no such method: "+i+". If you're using Internet Explorer 8 you should use es5-shim: https://github.com/kriskowal/es5-shim");return h===c?function(){var a=this.toArray();return b[i].apply(a,arguments),this}:h===d?function(){var a=this.toArray(),c=b[i].apply(a,arguments);return this.silentCreateFrom(a),j||this.trigger(i,{returns:c,arguments:arguments,method:i}),this}:h===e?function(){var c=this.toArray(),d=b[i].apply(c,arguments);return(new a.Array).silentCreateFrom(d)}:h===f?function(){var a=this.toArray();return b[i].apply(a,arguments)}:h===g?function(){var c=this.toArray(),d=b[i].apply(c,arguments);return this.silentCreateFrom(c),d=(new a.Array).silentCreateFrom(d),j||this.trigger(i,{returns:d,method:i,arguments:arguments}),d}:void 0};a.Array=Class({"extends":a,length:0,constructor:function(a){this.initMK();var b=arguments.length;if(1===b&&"number"==typeof a)this.length=a;else{for(var c=0;b>c;c++)this[c]=arguments[c];this.length=arguments.length}},createFrom:function(a,b){var c={createdFrom:a};return b&&(c.was=this.toNative()),this.silentCreateFrom(a).trigger("recreate",c),this},silentCreateFrom:function(a){for(var b=this.length-a.length,c=0;c<a.length;c++)this[c]=a[c];for(c=0;b>c;c++)delete this[c+a.length];return this.length=a.length,this},toArray:function(){try{return b.slice.call(this)}catch(a){for(var c=[],d=0;d<this.length;d++)c[d]=this[d];return c}},toNative:function(){return this.toArray()},initMK:function(){return a.Array.parent.initMK(this,arguments),this.on("recreate push pop unshift shift splice sort remove reverse",function(a){this.trigger("modify",a)})},hasOwnProperty:function(a){return"length"===a||a<this.length&&a>=0},toJSON:function(){for(var a=[],b=0;b<this.length;b++)this[b]&&this[b].toJSON?a.push(this[b].toJSON()):a.push(this[b]);return a},concat:function(){var b,c,d,e=arguments,f=this.toArray();for(b=0;b<e.length;b++)if(d=e[b],d instanceof Array||d&&d.instanceOf&&d.instanceOf(a.Array))for(c=0;c<d.length;c++)f.push(d[b]);return(new a.Array).createFrom(f)},push:h(d,"push"),pop:h(d,"pop"),unshift:h(d,"unshift"),shift:h(d,"shift"),sort:h(d,"sort"),reverse:h(d,"reverse"),splice:h(g,"splice"),silentPush:h(d,"push",!0),silentPop:h(d,"pop",!0),silentUnshift:h(d,"unshift",!0),silentShift:h(d,"shift",!0),silentSort:h(d,"sort",!0),silentReverse:h(d,"reverse",!0),silentSplice:h(g,"splice",!0),map:h(e,"map"),filter:h(e,"filter"),slice:h(e,"slice"),every:h(f,"every"),some:h(f,"some"),reduce:h(f,"reduce"),reduceRight:h(f,"reduceRight"),forEach:h(c,"forEach"),each:h(c,"forEach"),toString:h(f,"toString"),indexOf:h(f,"indexOf"),lastIndexOf:h(f,"lastIndexOf"),join:h(f,"join")})}(window.Matreshka,Array.prototype);